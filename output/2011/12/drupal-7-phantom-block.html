<!doctype html>
<!-- https://github.com/paulirish/html5-boilerplate/blob/master/index.html -->
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->
<!--[if lt IE 7 ]> <html lang="en" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="en" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="en" class="no-js ie8"> <![endif]-->
<!--[if (gte IE 9)|!(IE)]><!--> <html lang="en" class="no-js"> <!--<![endif]-->
<head>
    <meta charset="utf-8">
    
    <!-- encoding must be specified within the first 512 bytes
        www.whatwg.org/specs/web-apps/current-work/multipage/semantics.html#charset -->
    <!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame
        Remove this if you use the .htaccess
    <meta http-equiv="X-UA-Compatible" content="" -->>


    <!-- meta element for compatibility mode needs to be before
        all elements except title & meta
        msdn.microsoft.com/en-us/library/cc288325(VS.85).aspx -->
    <!-- Chrome Frame is only invoked if meta element for
        compatibility mode is within the first 1K bytes
        code.google.com/p/chromium/issues/detail?id=23003 -->

    <title>kfirbreger.com</title>
    <meta name="author" content="Kfir Breger">

    <!--  Mobile viewport optimized: j.mp/bplateviewport -->
    <meta name="viewport" content="">

    
    <!-- Place favicon.ico & apple-touch-icon.png
        in the root of your domain and delete these references -->
    <link rel="shortcut icon" href="/theme/favicon.ico">
    <link rel="apple-touch-icon" href="/theme/apple-touch-icon.png">
    

    
    <link rel="stylesheet" href="/theme/css/bootstrap.min.css">
    <link rel="stylesheet" href="/theme/css/bootstrap-responsive.min.css">
    

    
    <!-- All JavaScript at the bottom, except for Modernizr which
        enables HTML5 elements & feature detects
        <script src="/theme/js/modernizr.foundation.js"></script> -->
    
    
    
</head>
<body>
    
    <div id="container">
        
        <div id="main" role="main">
            <header class="banner clearfix">
                
    <h1 class="article-title">
        <a href="" rel="bookmark" title="Permalink to Drupal 7 phantom block">Drupal 7 phantom block</a>
    </h1>

                
                <nav>
                </nav>
                
            </header>
            
<section id="article">
    <article>
        <p>Today I can across an interesting change in the way Drupal 7 handles blocks
created via modules. In a module I made, I defined a block using the
<em>hook_block_info</em> and <em>hook_block_view</em>. This block was added to the site's
front page. After some implementation details changed it became apparent that
the current block was not what was needed but a whole series of other blocks.
Both hooks were completely rewritten to reflect this.</p>
<p>I noticed that the <em>hook_block_view</em> was called one to many times. Looking at
the front page, I saw that the, now removed block was still there. The block
admin page, however, did not show it. This was to be expected as there was no
info available for it. It was possible to configure the block though. Either
through typing the correct url, or through the small gear on the top right
side of that block. Both clearing the cache and turning the module on and off
have failed to remove this phantom block, which had no implementation but was
still around. Deinstalling the module was the only way to clear it out of the
block table (aside forma custom sql query of course). Since my module did not
have any custom information in the database this was not a problem. However if
your module does have such information, deinstalling it will remove all that
data. Since my module was available for deinstallation leads me the believe
that this is by design. Keep this in mind when building your modules.</p>
<p>Even after the block has been removed from the blocks table, it was still
visible. Further research led to the <strong>Context</strong> module. The block was added
to the display via a context reaction, and it seems that context does not
check if a block is still available. And so the <em>hook_block_view</em> of my module
was called with the delta of the old, non-existing, block. Opening the
reaction interface for context does not show that the block is part of it,
because, I assume, it is not defined. In the database however it is still
present. Saving the context with the phantom block without making any changes
does remove it from the database, and has removed it from the front page as
well.</p>
    </article>
    
    <p>tags:
        
            <a href="../.././">blocks</a>
        
            <a href="../.././">bug</a>
        
            <a href="../.././">context</a>
        
            <a href="../.././">drupal</a>
        
            <a href="../.././">drupal 7</a>
        
            <a href="../.././">programming</a>
        
    </p>


    <div class="share">
        
    <a href="http://twitter.com/share" class="twitter-share-button" data-count="horizontal" data-via="kfirbreger">Tweet</a>
    <script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>

    </div>
</section>

        </div>
        
    </div> <!--! end of #container -->
    <footer>
        
        
    </footer>
    
    
    <!-- Javascript at the bottom for fast page loading -->
    
    <!-- Grab Google CDN's jQuery, with a protocol relative URL; fall back to local if necessary -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.js"></script>
    <script>window.jQuery || document.write('<script src="js/libs/jquery.min.js">\x3C/script>')</script>
    

    
    <script src="/theme/js/bootstrap.js"></script>
    
    
</body>
</html>